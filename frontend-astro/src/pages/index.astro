---
export const prerender = true;

import Base from "../layouts/Base.astro";
import MainPost from "../layouts/home/MainPost.astro";
import NavArea from "../layouts/NavArea.astro";
import LaststNews from "../layouts/home/LastestNews.astro";
import LastestPost from "../layouts/home/LastestPost.astro";
import ContentLeft from "../layouts/home/ContentLeft.astro";
import ContentRight from "../layouts/home/ContentRight.astro";

import { fetchPostsList, PostsList } from "../api/data";

var data;

try {
  data = await fetchPostsList(
  "blog.BlogPage",
  "description,date_post,feed_image,categories(name),author",
  "-first_published_at"
  );

  // Process the response
} catch (error) {
  console.error('Error fetching data:', error);
  // Handle the error or show a user-friendly message
}

if (!data) return Astro.redirect("/404");
const posts = data.items.slice(0, 5);
const lastestPost = data.items.slice(0, 5);

const response = await fetch("http://127.0.0.1:8000/api/graphql",
  {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      query: `
          query {
            allBlog {
              title
              description
              author
            }
          }
        `
    }),
  });
const json = await response.json();
console.log(json.data)
---

<Base title="Tin tức mới nhất">
  

  <main>
    <NavArea />
    <LaststNews />
    <section id="sliderSection" style="content-visibility: auto;contain-intrinsic-size: 1000px;">
      <div class="row">
        <MainPost posts={posts} />
        <LastestPost posts={lastestPost} />
      </div>
    </section>
    <section id="contentSection"  style="content-visibility: auto;contain-intrinsic-size: 1000px;">
      <div class="row">
        <ContentLeft />
        <ContentRight />
      </div>
    </section>
  </main>
</Base>
